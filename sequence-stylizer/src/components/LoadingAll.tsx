import * as d3 from "d3";
import React, { useState } from "react";

const pi = Math.PI
const tau = 2*Math.PI

function mag(x: number, y: number){
    return Math.sqrt(x*x+y*y)
}

function sech(x: number){
    if(x==0){
        return 1
    }
    return 1/Math.cosh(x)
}

function displace(x: number,y: number, controlpt: number[]){
    const magnitude = mag(x-controlpt[0],y-controlpt[1]);
    return [x + 50*sech(magnitude/100)*(1-sech(magnitude/25))*(x-controlpt[0])/magnitude,
    y + 50*sech(magnitude/100)*(1-sech(magnitude/25))*(y-controlpt[1])/magnitude]
}

function project(x: number,y: number, z: number, controlpt: number[]){
    return [500+Math.cos(-controlpt[0])*x-Math.sin(-controlpt[0])*(z*Math.cos(-controlpt[1])+y*Math.sin(-controlpt[1])),
    250+Math.cos(-controlpt[1])*y-Math.sin(-controlpt[1])*z]
}

function project2(x: number,y: number){
    return [500+x,
    250-y]
}

const subdivs = 12

function stepfun(x: number): number{
    return 1/subdivs * Math.pow(0.5 - 0.5*Math.cos(pi*((subdivs*x)%1)),12) +
    1/subdivs * Math.floor(subdivs*x) +
    1/(12*subdivs)*sech(8*((subdivs*x)%1))*Math.sin(32*((subdivs*x)%1))
}

function bump(x: number,y: number, timer: number): number[]{
    return [x + 10*(Math.cos(100*x)+Math.cos(100*x+pi+tau*stepfun(timer))),
        y + 10*(Math.sin(100*x)+Math.sin(100*x+pi+tau*stepfun(timer)))]
}

const h = 500;
const w = 1000;

function drawLight(svgRef: React.RefObject<SVGSVGElement>, controlx: number,controly: number, timer: number) {
    const controlpt = [((controlx-750)),-(((controly-450)))]
    // [controlx-250,controly-200]
    const svg = d3.select(svgRef.current);
    svg
      .attr("width", w)
      .attr("height", h)
      .style("margin-top", 0)
      .style("margin-left", 0);
    
    var lpts = [{"x":-4.437,"y":0.77},{"x":-4.15,"y":0.773},{"x":-4.147,"y":-0.4},{"x":-3.428,"y":-0.41},{"x":-3.425,"y":-0.643},{"x":-4.445,"y":-0.646}];
    var opts = [{"x":-2.597,"y": 0.823},{"x":-2.4,"y": 0.8},{"x":-2.201,"y": 0.717},{"x":-2.033,"y": 0.565},{"x":-1.95,"y": 0.4},{"x":-1.9,"y": 0.25},{"x":-1.882,"y": 0.045},{"x":-1.9,"y": -0.1},{"x":-1.945,"y": -0.279},{"x":-2.02,"y": -0.418},{"x":-2.126,"y": -0.522},{"x":-2.25,"y": -0.6},{"x":-2.4,"y": -0.65},{"x":-2.551,"y": -0.673},{"x":-2.702,"y": -0.666},{"x":-2.855,"y": -0.632},{"x":-3,"y": -0.55},{"x":-3.114,"y": -0.459},{"x":-3.2,"y": -0.35},{"x":-3.25,"y": -0.2},{"x":-3.286,"y": -0.054},{"x":-3.286,"y": 0.099},{"x":-3.268,"y": 0.25},{"x":-2.978,"y": 0.18},{"x":-2.983,"y": 0.001},{"x":-2.944,"y": -0.175},{"x":-2.857,"y": -0.31},{"x":-2.724,"y": -0.395},{"x":-2.575,"y": -0.42},{"x":-2.394,"y": -0.372},{"x":-2.268,"y": -0.25},{"x":-2.2,"y": -0.1},{"x":-2.187,"y": 0.102},{"x":-2.2,"y": 0.25},{"x":-2.248,"y": 0.371},{"x":-2.35,"y": 0.5},{"x":-2.5,"y": 0.55},{"x":-2.7,"y": 0.55},{"x":-2.86,"y": 0.46},{"x":-2.941,"y": 0.328},{"x":-2.9775,"y": 0.185},{"x":-3.267,"y": 0.257},{"x":-3.2,"y": 0.45},{"x":-3.1,"y": 0.6},{"x":-2.953,"y": 0.733},{"x":-2.784,"y": 0.796}]
    var apts = [{"x":-1.244,"y":0.787},{"x":-0.937,"y":0.79},{"x":-0.36,"y":-0.64},{"x":-0.68,"y":-0.64},{"x":-0.812,"y":-0.322},{"x":-1.002,"y":-0.322},{"x":-0.998,"y":-0.073},{"x":-0.905,"y":-0.073},{"x":-1.094,"y":0.441},{"x":-1.29,"y":-0.073},{"x":-1,"y":-0.073},{"x":-1.006,"y":-0.322},{"x":-1.375,"y":-0.325},{"x":-1.5,"y":-0.65},{"x":-1.815,"y":-0.651}]
    var dpts = [{"x":-0.2,"y":0.8},{"x":0.3,"y":0.8},{"x":0.528,"y":0.78},{"x":0.7,"y":0.7},{"x":0.855,"y":0.583},{"x":0.948,"y":0.4},{"x":1,"y":0.2},{"x":1,"y":0},{"x":0.97,"y":-0.198},{"x":0.882,"y":-0.396},{"x":0.707,"y":-0.57},{"x":0.497,"y":-0.64},{"x":0.301,"y":-0.651},{"x":0.08,"y":-0.65},{"x":0.085,"y":-0.4},{"x":0.3,"y":-0.4},{"x":0.468,"y":-0.385},{"x":0.55,"y":-0.35},{"x":0.61,"y":-0.309},{"x":0.66,"y":-0.212},{"x":0.682,"y":-0.1},{"x":0.7,"y":0.05},{"x":0.688,"y":0.2},{"x":0.65,"y":0.35},{"x":0.6,"y":0.45},{"x":0.55,"y":0.5},{"x":0.453,"y":0.53},{"x":0.3,"y":0.55},{"x":0.083,"y":0.55},{"x":0.08,"y":-0.4},{"x":0.075,"y":-0.65},{"x":-0.2,"y":-0.64}]
    var ipts = [{"x":1.234,"y":0.8},{"x":1.525,"y":0.793},{"x":1.525,"y":-0.65},{"x":1.23,"y":-0.648}]
    var npts = [{"x":1.8,"y":0.8},{"x":2.1,"y":0.8},{"x":2.674,"y":-0.152},{"x":2.677,"y":0.799},{"x":2.95,"y":0.796},{"x":2.951,"y":-0.648},{"x":2.654,"y":-0.653},{"x":2.077,"y":0.275},{"x":2.077,"y":-0.64},{"x":1.804,"y":-0.646}]
    var gpts = [{"x":3.924,"y":0.124},{"x":4.547,"y":0.124},{"x":4.55,"y":-0.46},{"x":4.3,"y":-0.6},{"x":4.01,"y":-0.667},{"x":3.77,"y":-0.66},{"x":3.515,"y":-0.567},{"x":3.338,"y":-0.405},{"x":3.245,"y":-0.205},{"x":3.2,"y":0},{"x":3.217,"y":0.197},{"x":3.26,"y":0.4},{"x":3.35,"y":0.568},{"x":3.5,"y":0.7},{"x":3.7,"y":0.8},{"x":3.9,"y":0.823},{"x":4.1,"y":0.8},{"x":4.31,"y":0.72},{"x":4.45,"y":0.593},{"x":4.537,"y":0.396},{"x":4.253,"y":0.335},{"x":4.157,"y":0.468},{"x":4,"y":0.55},{"x":3.8,"y":0.55},{"x":3.635,"y":0.466},{"x":3.554,"y":0.34},{"x":3.5,"y":0.2},{"x":3.5,"y":0},{"x":3.555,"y":-0.206},{"x":3.7,"y":-0.357},{"x":3.85,"y":-0.418},{"x":3.998,"y":-0.42},{"x":4.143,"y":-0.362},{"x":4.25,"y":-0.3},{"x":4.247,"y":-0.123},{"x":3.92,"y":-0.12}]
    var box = [{"x":6,"y":-3},{"x":6,"y":3},{"x":-6,"y":3},{"x":-6,"y":-3}]
    var conns = [{"x":0,"y":1},{"x":1,"y":2},{"x":2,"y":3},{"x":3,"y":4},{"x":4,"y":5},{"x":5,"y":0},{"x":6,"y":7},{"x":7,"y":8},{"x":8,"y":9},{"x":9,"y":10},{"x":10,"y":11},{"x":11,"y":12},{"x":12,"y":13},{"x":13,"y":14},{"x":14,"y":15},{"x":15,"y":16},{"x":16,"y":17},{"x":17,"y":18},{"x":18,"y":19},{"x":19,"y":20},{"x":20,"y":21},{"x":21,"y":22},{"x":22,"y":23},{"x":23,"y":24},{"x":24,"y":25},{"x":25,"y":26},{"x":26,"y":27},{"x":27,"y":28},{"x":28,"y":29},{"x":29,"y":30},{"x":30,"y":31},{"x":31,"y":32},{"x":32,"y":33},{"x":33,"y":34},{"x":34,"y":35},{"x":35,"y":36},{"x":36,"y":37},{"x":37,"y":38},{"x":38,"y":39},{"x":39,"y":40},{"x":40,"y":41},{"x":41,"y":42},{"x":42,"y":43},{"x":43,"y":44},{"x":44,"y":45},{"x":45,"y":46},{"x":46,"y":47},{"x":47,"y":48},{"x":48,"y":49},{"x":49,"y":50},{"x":50,"y":51},{"x":51,"y":6},{"x":52,"y":53},{"x":53,"y":54},{"x":54,"y":55},{"x":55,"y":56},{"x":56,"y":57},{"x":57,"y":58},{"x":58,"y":59},{"x":59,"y":60},{"x":60,"y":61},{"x":61,"y":62},{"x":62,"y":63},{"x":63,"y":64},{"x":64,"y":65},{"x":65,"y":66},{"x":66,"y":52},{"x":67,"y":68},{"x":68,"y":69},{"x":69,"y":70},{"x":70,"y":71},{"x":71,"y":72},{"x":72,"y":73},{"x":73,"y":74},{"x":74,"y":75},{"x":75,"y":76},{"x":76,"y":77},{"x":77,"y":78},{"x":78,"y":79},{"x":79,"y":80},{"x":80,"y":81},{"x":81,"y":82},{"x":82,"y":83},{"x":83,"y":84},{"x":84,"y":85},{"x":85,"y":86},{"x":86,"y":87},{"x":87,"y":88},{"x":88,"y":89},{"x":89,"y":90},{"x":90,"y":91},{"x":91,"y":92},{"x":92,"y":93},{"x":93,"y":94},{"x":94,"y":95},{"x":95,"y":96},{"x":96,"y":97},{"x":97,"y":98},{"x":98,"y":67},{"x":99,"y":100},{"x":100,"y":101},{"x":101,"y":102},{"x":102,"y":99},{"x":103,"y":104},{"x":104,"y":105},{"x":105,"y":106},{"x":106,"y":107},{"x":107,"y":108},{"x":108,"y":109},{"x":109,"y":110},{"x":110,"y":111},{"x":111,"y":112},{"x":112,"y":103},{"x":113,"y":114},{"x":114,"y":115},{"x":115,"y":116},{"x":116,"y":117},{"x":117,"y":118},{"x":118,"y":119},{"x":119,"y":120},{"x":120,"y":121},{"x":121,"y":122},{"x":122,"y":123},{"x":123,"y":124},{"x":124,"y":125},{"x":125,"y":126},{"x":126,"y":127},{"x":127,"y":128},{"x":128,"y":129},{"x":129,"y":130},{"x":130,"y":131},{"x":131,"y":132},{"x":132,"y":133},{"x":133,"y":134},{"x":134,"y":135},{"x":135,"y":136},{"x":136,"y":137},{"x":137,"y":138},{"x":138,"y":139},{"x":139,"y":140},{"x":140,"y":141},{"x":141,"y":142},{"x":142,"y":143},{"x":143,"y":144},{"x":144,"y":145},{"x":145,"y":146},{"x":146,"y":147},{"x":147,"y":148},{"x":148,"y":113},{"x":149,"y":150},{"x":151,"y":150},{"x":151,"y":152},{"x":149,"y":152}]
    var indpts = [{"x":-4.437,"y":0.77},{"x":-4.15,"y":0.773},{"x":-4.147,"y":-0.4},{"x":-3.428,"y":-0.41},{"x":-3.425,"y":-0.643},{"x":-4.445,"y":-0.646},
    {"x":-2.597,"y": 0.823},{"x":-2.4,"y": 0.8},{"x":-2.201,"y": 0.717},{"x":-2.033,"y": 0.565},{"x":-1.95,"y": 0.4},{"x":-1.9,"y": 0.25},{"x":-1.882,"y": 0.045},{"x":-1.9,"y": -0.1},{"x":-1.945,"y": -0.279},{"x":-2.02,"y": -0.418},{"x":-2.126,"y": -0.522},{"x":-2.25,"y": -0.6},{"x":-2.4,"y": -0.65},{"x":-2.551,"y": -0.673},{"x":-2.702,"y": -0.666},{"x":-2.855,"y": -0.632},{"x":-3,"y": -0.55},{"x":-3.114,"y": -0.459},{"x":-3.2,"y": -0.35},{"x":-3.25,"y": -0.2},{"x":-3.286,"y": -0.054},{"x":-3.286,"y": 0.099},{"x":-3.268,"y": 0.25},{"x":-2.978,"y": 0.18},{"x":-2.983,"y": 0.001},{"x":-2.944,"y": -0.175},{"x":-2.857,"y": -0.31},{"x":-2.724,"y": -0.395},{"x":-2.575,"y": -0.42},{"x":-2.394,"y": -0.372},{"x":-2.268,"y": -0.25},{"x":-2.2,"y": -0.1},{"x":-2.187,"y": 0.102},{"x":-2.2,"y": 0.25},{"x":-2.248,"y": 0.371},{"x":-2.35,"y": 0.5},{"x":-2.5,"y": 0.55},{"x":-2.7,"y": 0.55},{"x":-2.86,"y": 0.46},{"x":-2.941,"y": 0.328},{"x":-2.9775,"y": 0.185},{"x":-3.267,"y": 0.257},{"x":-3.2,"y": 0.45},{"x":-3.1,"y": 0.6},{"x":-2.953,"y": 0.733},{"x":-2.784,"y": 0.796},
    {"x":-1.244,"y":0.787},{"x":-0.937,"y":0.79},{"x":-0.36,"y":-0.64},{"x":-0.68,"y":-0.64},{"x":-0.812,"y":-0.322},{"x":-1.002,"y":-0.322},{"x":-0.998,"y":-0.073},{"x":-0.905,"y":-0.073},{"x":-1.094,"y":0.441},{"x":-1.29,"y":-0.073},{"x":-1,"y":-0.073},{"x":-1.006,"y":-0.322},{"x":-1.375,"y":-0.325},{"x":-1.5,"y":-0.65},{"x":-1.815,"y":-0.651},
    {"x":-0.2,"y":0.8},{"x":0.3,"y":0.8},{"x":0.528,"y":0.78},{"x":0.7,"y":0.7},{"x":0.855,"y":0.583},{"x":0.948,"y":0.4},{"x":1,"y":0.2},{"x":1,"y":0},{"x":0.97,"y":-0.198},{"x":0.882,"y":-0.396},{"x":0.707,"y":-0.57},{"x":0.497,"y":-0.64},{"x":0.301,"y":-0.651},{"x":0.08,"y":-0.65},{"x":0.085,"y":-0.4},{"x":0.3,"y":-0.4},{"x":0.468,"y":-0.385},{"x":0.55,"y":-0.35},{"x":0.61,"y":-0.309},{"x":0.66,"y":-0.212},{"x":0.682,"y":-0.1},{"x":0.7,"y":0.05},{"x":0.688,"y":0.2},{"x":0.65,"y":0.35},{"x":0.6,"y":0.45},{"x":0.55,"y":0.5},{"x":0.453,"y":0.53},{"x":0.3,"y":0.55},{"x":0.083,"y":0.55},{"x":0.08,"y":-0.4},{"x":0.075,"y":-0.65},{"x":-0.2,"y":-0.64},
    {"x":1.234,"y":0.8},{"x":1.525,"y":0.793},{"x":1.525,"y":-0.65},{"x":1.23,"y":-0.648},
    {"x":1.8,"y":0.8},{"x":2.1,"y":0.8},{"x":2.674,"y":-0.152},{"x":2.677,"y":0.799},{"x":2.95,"y":0.796},{"x":2.951,"y":-0.648},{"x":2.654,"y":-0.653},{"x":2.077,"y":0.275},{"x":2.077,"y":-0.64},{"x":1.804,"y":-0.646},
    {"x":3.924,"y":0.124},{"x":4.547,"y":0.124},{"x":4.55,"y":-0.46},{"x":4.3,"y":-0.6},{"x":4.01,"y":-0.667},{"x":3.77,"y":-0.66},{"x":3.515,"y":-0.567},{"x":3.338,"y":-0.405},{"x":3.245,"y":-0.205},{"x":3.2,"y":0},{"x":3.217,"y":0.197},{"x":3.26,"y":0.4},{"x":3.35,"y":0.568},{"x":3.5,"y":0.7},{"x":3.7,"y":0.8},{"x":3.9,"y":0.823},{"x":4.1,"y":0.8},{"x":4.31,"y":0.72},{"x":4.45,"y":0.593},{"x":4.537,"y":0.396},{"x":4.253,"y":0.335},{"x":4.157,"y":0.468},{"x":4,"y":0.55},{"x":3.8,"y":0.55},{"x":3.635,"y":0.466},{"x":3.554,"y":0.34},{"x":3.5,"y":0.2},{"x":3.5,"y":0},{"x":3.555,"y":-0.206},{"x":3.7,"y":-0.357},{"x":3.85,"y":-0.418},{"x":3.998,"y":-0.42},{"x":4.143,"y":-0.362},{"x":4.25,"y":-0.3},{"x":4.247,"y":-0.123},{"x":3.92,"y":-0.12},
    {"x":6,"y":-3},{"x":6,"y":3},{"x":-6,"y":3},{"x":-6,"y":-3}]
    const l0 = d3.range(150)
    
    var polypts = l0.map(function(index){
        return [indpts[conns[index].x],indpts[conns[index].y],
        {"x": 1000*(2*indpts[conns[index].y].x - controlpt[0]/50),"y": 1000*(2*indpts[conns[index].y].y-controlpt[1]/50)},
        {"x": 1000*(2*indpts[conns[index].x].x - controlpt[0]/50),"y": 1000*(2*indpts[conns[index].x].y-controlpt[1]/50)}]

    })

    var allpts = polypts.concat([lpts,opts,apts,dpts,ipts,npts,gpts])
    var range1 = d3.range((allpts).length)

    svg.selectAll("polygon").remove()
    svg.selectAll("path").remove()
    svg.selectAll("circle").remove()

    // So we can get one layer of text- can we do multiple players? 
    // Might be a clever way to do this in the append function, or do some annoying mapping stuff idk

    svg.selectAll("polygon")
    .data(range1)
    .enter().append("polygon")
    .attr("points",function(index) {
        var points = allpts[index]
        return points.map(function(point) {
            return project2(100*point.x,
                100*point.y).join(",");
        }).join(" ");
    })
    .attr("stroke","none")
    .attr("fill", function(index) {
        if (index < polypts.length ){
            return "black"
        }
            return "white"
    })

    svg.append("circle")
    .attr("cx", project2(controlpt[0],controlpt[1])[0])
    .attr("cy", project2(controlpt[0],controlpt[1])[1])
    .attr("r", 20)
    .attr("fill", "red");
}

function drawClock(svgRef: React.RefObject<SVGSVGElement>, timer: number) {
    // [controlx-250,controly-200]
    const svg = d3.select(svgRef.current);
    svg
      .attr("width", w)
      .attr("height", h)
      .style("margin-top", 50)
      .style("margin-left", 50);
    
    var lpts = [{"x":-4.437,"y":0.77},{"x":-4.15,"y":0.773},{"x":-4.147,"y":-0.4},{"x":-3.428,"y":-0.41},{"x":-3.425,"y":-0.643},{"x":-4.445,"y":-0.646}];
    var opts = [{"x":-2.597,"y": 0.823},{"x":-2.4,"y": 0.8},{"x":-2.201,"y": 0.717},{"x":-2.033,"y": 0.565},{"x":-1.95,"y": 0.4},{"x":-1.9,"y": 0.25},{"x":-1.882,"y": 0.045},{"x":-1.9,"y": -0.1},{"x":-1.945,"y": -0.279},{"x":-2.02,"y": -0.418},{"x":-2.126,"y": -0.522},{"x":-2.25,"y": -0.6},{"x":-2.4,"y": -0.65},{"x":-2.551,"y": -0.673},{"x":-2.702,"y": -0.666},{"x":-2.855,"y": -0.632},{"x":-3,"y": -0.55},{"x":-3.114,"y": -0.459},{"x":-3.2,"y": -0.35},{"x":-3.25,"y": -0.2},{"x":-3.286,"y": -0.054},{"x":-3.286,"y": 0.099},{"x":-3.268,"y": 0.25},{"x":-2.978,"y": 0.18},{"x":-2.983,"y": 0.001},{"x":-2.944,"y": -0.175},{"x":-2.857,"y": -0.31},{"x":-2.724,"y": -0.395},{"x":-2.575,"y": -0.42},{"x":-2.394,"y": -0.372},{"x":-2.268,"y": -0.25},{"x":-2.2,"y": -0.1},{"x":-2.187,"y": 0.102},{"x":-2.2,"y": 0.25},{"x":-2.248,"y": 0.371},{"x":-2.35,"y": 0.5},{"x":-2.5,"y": 0.55},{"x":-2.7,"y": 0.55},{"x":-2.86,"y": 0.46},{"x":-2.941,"y": 0.328},{"x":-2.9775,"y": 0.185},{"x":-3.267,"y": 0.257},{"x":-3.2,"y": 0.45},{"x":-3.1,"y": 0.6},{"x":-2.953,"y": 0.733},{"x":-2.784,"y": 0.796}]
    var apts = [{"x":-1.244,"y":0.787},{"x":-0.937,"y":0.79},{"x":-0.36,"y":-0.64},{"x":-0.68,"y":-0.64},{"x":-0.812,"y":-0.322},{"x":-1.002,"y":-0.322},{"x":-0.998,"y":-0.073},{"x":-0.905,"y":-0.073},{"x":-1.094,"y":0.441},{"x":-1.29,"y":-0.073},{"x":-1,"y":-0.073},{"x":-1.006,"y":-0.322},{"x":-1.375,"y":-0.325},{"x":-1.5,"y":-0.65},{"x":-1.815,"y":-0.651}]
    var dpts = [{"x":-0.2,"y":0.8},{"x":0.3,"y":0.8},{"x":0.528,"y":0.78},{"x":0.7,"y":0.7},{"x":0.855,"y":0.583},{"x":0.948,"y":0.4},{"x":1,"y":0.2},{"x":1,"y":0},{"x":0.97,"y":-0.198},{"x":0.882,"y":-0.396},{"x":0.707,"y":-0.57},{"x":0.497,"y":-0.64},{"x":0.301,"y":-0.651},{"x":0.08,"y":-0.65},{"x":0.085,"y":-0.4},{"x":0.3,"y":-0.4},{"x":0.468,"y":-0.385},{"x":0.55,"y":-0.35},{"x":0.61,"y":-0.309},{"x":0.66,"y":-0.212},{"x":0.682,"y":-0.1},{"x":0.7,"y":0.05},{"x":0.688,"y":0.2},{"x":0.65,"y":0.35},{"x":0.6,"y":0.45},{"x":0.55,"y":0.5},{"x":0.453,"y":0.53},{"x":0.3,"y":0.55},{"x":0.083,"y":0.55},{"x":0.08,"y":-0.4},{"x":0.075,"y":-0.65},{"x":-0.2,"y":-0.64}]
    var ipts = [{"x":1.234,"y":0.8},{"x":1.525,"y":0.793},{"x":1.525,"y":-0.65},{"x":1.23,"y":-0.648}]
    var npts = [{"x":1.8,"y":0.8},{"x":2.1,"y":0.8},{"x":2.674,"y":-0.152},{"x":2.677,"y":0.799},{"x":2.95,"y":0.796},{"x":2.951,"y":-0.648},{"x":2.654,"y":-0.653},{"x":2.077,"y":0.275},{"x":2.077,"y":-0.64},{"x":1.804,"y":-0.646}]
    var gpts = [{"x":3.924,"y":0.124},{"x":4.547,"y":0.124},{"x":4.55,"y":-0.46},{"x":4.3,"y":-0.6},{"x":4.01,"y":-0.667},{"x":3.77,"y":-0.66},{"x":3.515,"y":-0.567},{"x":3.338,"y":-0.405},{"x":3.245,"y":-0.205},{"x":3.2,"y":0},{"x":3.217,"y":0.197},{"x":3.26,"y":0.4},{"x":3.35,"y":0.568},{"x":3.5,"y":0.7},{"x":3.7,"y":0.8},{"x":3.9,"y":0.823},{"x":4.1,"y":0.8},{"x":4.31,"y":0.72},{"x":4.45,"y":0.593},{"x":4.537,"y":0.396},{"x":4.253,"y":0.335},{"x":4.157,"y":0.468},{"x":4,"y":0.55},{"x":3.8,"y":0.55},{"x":3.635,"y":0.466},{"x":3.554,"y":0.34},{"x":3.5,"y":0.2},{"x":3.5,"y":0},{"x":3.555,"y":-0.206},{"x":3.7,"y":-0.357},{"x":3.85,"y":-0.418},{"x":3.998,"y":-0.42},{"x":4.143,"y":-0.362},{"x":4.25,"y":-0.3},{"x":4.247,"y":-0.123},{"x":3.92,"y":-0.12}]
    var allpts = [lpts,opts,apts,dpts,ipts,npts,gpts]

    svg.selectAll("polygon").remove()
    svg.selectAll("path").remove()
    svg.selectAll("circle").remove()

    // So we can get one layer of text- can we do multiple players? 
    // Might be a clever way to do this in the append function, or do some annoying mapping stuff idk

    const path = d3.line()([[w/2,h/2],
    [w/2+150*Math.cos(tau*stepfun(timer)),
    h/2+150*Math.sin(tau*stepfun(timer))]])

    const path2 = d3.line()([[w/2,h/2],
    [w/2+300*Math.cos(tau*stepfun(2*timer)),
    h/2+300*Math.sin(tau*stepfun(2*timer))]])

    svg.selectAll("polygon")
    .data(allpts)
    .enter().append("polygon")
    .attr("points",function(d) { 
        return d.map(function(d) {
            return bump((100*d.x+w/2),(-100*d.y+h/2),timer).join(",");
        }).join(" ");
    })
    .attr("stroke","black")
    .attr("stroke-width",2)

    svg.append("path")
    .attr("d", path)
    .attr("stroke", "red")
    .attr("stroke-width",10)
    .attr("fill", "none")

    svg.append("path")
    .attr("d", path2)
    .attr("stroke", "red")
    .attr("stroke-width",10)
    .attr("fill", "none")

    svg.append("circle")
    .attr("cx", w/2)
    .attr("cy", h/2)
    .attr("r",10)
    .attr("stroke", "none")
    .attr("fill", "red")
}

function drawDistort(svgRef: React.RefObject<SVGSVGElement>, controlx: number,controly: number) {
    const controlpt = [controlx-250,controly-200]
    const svg = d3.select(svgRef.current);
    svg
      .attr("width", w)
      .attr("height", h)
      .style("margin-top", 50)
      .style("margin-left", 50);
    
    var lpts = [{"x":-4.437,"y":0.77},{"x":-4.15,"y":0.773},{"x":-4.147,"y":-0.4},{"x":-3.428,"y":-0.41},{"x":-3.425,"y":-0.643},{"x":-4.445,"y":-0.646}];
    var opts = [{"x":-2.597,"y": 0.823},{"x":-2.4,"y": 0.8},{"x":-2.201,"y": 0.717},{"x":-2.033,"y": 0.565},{"x":-1.95,"y": 0.4},{"x":-1.9,"y": 0.25},{"x":-1.882,"y": 0.045},{"x":-1.9,"y": -0.1},{"x":-1.945,"y": -0.279},{"x":-2.02,"y": -0.418},{"x":-2.126,"y": -0.522},{"x":-2.25,"y": -0.6},{"x":-2.4,"y": -0.65},{"x":-2.551,"y": -0.673},{"x":-2.702,"y": -0.666},{"x":-2.855,"y": -0.632},{"x":-3,"y": -0.55},{"x":-3.114,"y": -0.459},{"x":-3.2,"y": -0.35},{"x":-3.25,"y": -0.2},{"x":-3.286,"y": -0.054},{"x":-3.286,"y": 0.099},{"x":-3.268,"y": 0.25},{"x":-2.978,"y": 0.18},{"x":-2.983,"y": 0.001},{"x":-2.944,"y": -0.175},{"x":-2.857,"y": -0.31},{"x":-2.724,"y": -0.395},{"x":-2.575,"y": -0.42},{"x":-2.394,"y": -0.372},{"x":-2.268,"y": -0.25},{"x":-2.2,"y": -0.1},{"x":-2.187,"y": 0.102},{"x":-2.2,"y": 0.25},{"x":-2.248,"y": 0.371},{"x":-2.35,"y": 0.5},{"x":-2.5,"y": 0.55},{"x":-2.7,"y": 0.55},{"x":-2.86,"y": 0.46},{"x":-2.941,"y": 0.328},{"x":-2.9775,"y": 0.185},{"x":-3.267,"y": 0.257},{"x":-3.2,"y": 0.45},{"x":-3.1,"y": 0.6},{"x":-2.953,"y": 0.733},{"x":-2.784,"y": 0.796}]
    var apts = [{"x":-1.244,"y":0.787},{"x":-0.937,"y":0.79},{"x":-0.36,"y":-0.64},{"x":-0.68,"y":-0.64},{"x":-0.812,"y":-0.322},{"x":-1.002,"y":-0.322},{"x":-0.998,"y":-0.073},{"x":-0.905,"y":-0.073},{"x":-1.094,"y":0.441},{"x":-1.29,"y":-0.073},{"x":-1,"y":-0.073},{"x":-1.006,"y":-0.322},{"x":-1.375,"y":-0.325},{"x":-1.5,"y":-0.65},{"x":-1.815,"y":-0.651}]
    var dpts = [{"x":-0.2,"y":0.8},{"x":0.3,"y":0.8},{"x":0.528,"y":0.78},{"x":0.7,"y":0.7},{"x":0.855,"y":0.583},{"x":0.948,"y":0.4},{"x":1,"y":0.2},{"x":1,"y":0},{"x":0.97,"y":-0.198},{"x":0.882,"y":-0.396},{"x":0.707,"y":-0.57},{"x":0.497,"y":-0.64},{"x":0.301,"y":-0.651},{"x":0.08,"y":-0.65},{"x":0.085,"y":-0.4},{"x":0.3,"y":-0.4},{"x":0.468,"y":-0.385},{"x":0.55,"y":-0.35},{"x":0.61,"y":-0.309},{"x":0.66,"y":-0.212},{"x":0.682,"y":-0.1},{"x":0.7,"y":0.05},{"x":0.688,"y":0.2},{"x":0.65,"y":0.35},{"x":0.6,"y":0.45},{"x":0.55,"y":0.5},{"x":0.453,"y":0.53},{"x":0.3,"y":0.55},{"x":0.083,"y":0.55},{"x":0.08,"y":-0.4},{"x":0.075,"y":-0.65},{"x":-0.2,"y":-0.64}]
    var ipts = [{"x":1.234,"y":0.8},{"x":1.525,"y":0.793},{"x":1.525,"y":-0.65},{"x":1.23,"y":-0.648}]
    var npts = [{"x":1.8,"y":0.8},{"x":2.1,"y":0.8},{"x":2.674,"y":-0.152},{"x":2.677,"y":0.799},{"x":2.95,"y":0.796},{"x":2.951,"y":-0.648},{"x":2.654,"y":-0.653},{"x":2.077,"y":0.275},{"x":2.077,"y":-0.64},{"x":1.804,"y":-0.646}]
    var gpts = [{"x":3.924,"y":0.124},{"x":4.547,"y":0.124},{"x":4.55,"y":-0.46},{"x":4.3,"y":-0.6},{"x":4.01,"y":-0.667},{"x":3.77,"y":-0.66},{"x":3.515,"y":-0.567},{"x":3.338,"y":-0.405},{"x":3.245,"y":-0.205},{"x":3.2,"y":0},{"x":3.217,"y":0.197},{"x":3.26,"y":0.4},{"x":3.35,"y":0.568},{"x":3.5,"y":0.7},{"x":3.7,"y":0.8},{"x":3.9,"y":0.823},{"x":4.1,"y":0.8},{"x":4.31,"y":0.72},{"x":4.45,"y":0.593},{"x":4.537,"y":0.396},{"x":4.253,"y":0.335},{"x":4.157,"y":0.468},{"x":4,"y":0.55},{"x":3.8,"y":0.55},{"x":3.635,"y":0.466},{"x":3.554,"y":0.34},{"x":3.5,"y":0.2},{"x":3.5,"y":0},{"x":3.555,"y":-0.206},{"x":3.7,"y":-0.357},{"x":3.85,"y":-0.418},{"x":3.998,"y":-0.42},{"x":4.143,"y":-0.362},{"x":4.25,"y":-0.3},{"x":4.247,"y":-0.123},{"x":3.92,"y":-0.12}]
    var allpts = [lpts,opts,apts,dpts,ipts,npts,gpts]

    svg.selectAll("polygon").remove()
    svg.selectAll("path").remove()
    svg.selectAll("circle").remove()

    svg.selectAll("polygon")
    .data(allpts)
    .enter().append("polygon")
    .attr("points",function(d) { 
        return d.map(function(d) {
            return displace((100*d.x+w/2),(-100*d.y+h/2),controlpt).join(",");
        }).join(" ");
    })
    .attr("stroke","black")
    .attr("stroke-width",2)

    svg.append("circle")
    .attr("cx", controlpt[0])
    .attr("cy", controlpt[1])
    .attr("r", 20)
    .attr("fill", "red");

}

function draw3D(svgRef: React.RefObject<SVGSVGElement>, controlx: number,controly: number, timer: number) {
    const controlpt = [controlx/100,controly/100]
    // [controlx-250,controly-200]
    const svg = d3.select(svgRef.current);
    svg
      .attr("width", w)
      .attr("height", h)
      .style("margin-top", 50)
      .style("margin-left", 50);
    
    var lpts = [{"x":-4.437,"y":0.77},{"x":-4.15,"y":0.773},{"x":-4.147,"y":-0.4},{"x":-3.428,"y":-0.41},{"x":-3.425,"y":-0.643},{"x":-4.445,"y":-0.646}];
    var opts = [{"x":-2.597,"y": 0.823},{"x":-2.4,"y": 0.8},{"x":-2.201,"y": 0.717},{"x":-2.033,"y": 0.565},{"x":-1.95,"y": 0.4},{"x":-1.9,"y": 0.25},{"x":-1.882,"y": 0.045},{"x":-1.9,"y": -0.1},{"x":-1.945,"y": -0.279},{"x":-2.02,"y": -0.418},{"x":-2.126,"y": -0.522},{"x":-2.25,"y": -0.6},{"x":-2.4,"y": -0.65},{"x":-2.551,"y": -0.673},{"x":-2.702,"y": -0.666},{"x":-2.855,"y": -0.632},{"x":-3,"y": -0.55},{"x":-3.114,"y": -0.459},{"x":-3.2,"y": -0.35},{"x":-3.25,"y": -0.2},{"x":-3.286,"y": -0.054},{"x":-3.286,"y": 0.099},{"x":-3.268,"y": 0.25},{"x":-2.978,"y": 0.18},{"x":-2.983,"y": 0.001},{"x":-2.944,"y": -0.175},{"x":-2.857,"y": -0.31},{"x":-2.724,"y": -0.395},{"x":-2.575,"y": -0.42},{"x":-2.394,"y": -0.372},{"x":-2.268,"y": -0.25},{"x":-2.2,"y": -0.1},{"x":-2.187,"y": 0.102},{"x":-2.2,"y": 0.25},{"x":-2.248,"y": 0.371},{"x":-2.35,"y": 0.5},{"x":-2.5,"y": 0.55},{"x":-2.7,"y": 0.55},{"x":-2.86,"y": 0.46},{"x":-2.941,"y": 0.328},{"x":-2.9775,"y": 0.185},{"x":-3.267,"y": 0.257},{"x":-3.2,"y": 0.45},{"x":-3.1,"y": 0.6},{"x":-2.953,"y": 0.733},{"x":-2.784,"y": 0.796}]
    var apts = [{"x":-1.244,"y":0.787},{"x":-0.937,"y":0.79},{"x":-0.36,"y":-0.64},{"x":-0.68,"y":-0.64},{"x":-0.812,"y":-0.322},{"x":-1.002,"y":-0.322},{"x":-0.998,"y":-0.073},{"x":-0.905,"y":-0.073},{"x":-1.094,"y":0.441},{"x":-1.29,"y":-0.073},{"x":-1,"y":-0.073},{"x":-1.006,"y":-0.322},{"x":-1.375,"y":-0.325},{"x":-1.5,"y":-0.65},{"x":-1.815,"y":-0.651}]
    var dpts = [{"x":-0.2,"y":0.8},{"x":0.3,"y":0.8},{"x":0.528,"y":0.78},{"x":0.7,"y":0.7},{"x":0.855,"y":0.583},{"x":0.948,"y":0.4},{"x":1,"y":0.2},{"x":1,"y":0},{"x":0.97,"y":-0.198},{"x":0.882,"y":-0.396},{"x":0.707,"y":-0.57},{"x":0.497,"y":-0.64},{"x":0.301,"y":-0.651},{"x":0.08,"y":-0.65},{"x":0.085,"y":-0.4},{"x":0.3,"y":-0.4},{"x":0.468,"y":-0.385},{"x":0.55,"y":-0.35},{"x":0.61,"y":-0.309},{"x":0.66,"y":-0.212},{"x":0.682,"y":-0.1},{"x":0.7,"y":0.05},{"x":0.688,"y":0.2},{"x":0.65,"y":0.35},{"x":0.6,"y":0.45},{"x":0.55,"y":0.5},{"x":0.453,"y":0.53},{"x":0.3,"y":0.55},{"x":0.083,"y":0.55},{"x":0.08,"y":-0.4},{"x":0.075,"y":-0.65},{"x":-0.2,"y":-0.64}]
    var ipts = [{"x":1.234,"y":0.8},{"x":1.525,"y":0.793},{"x":1.525,"y":-0.65},{"x":1.23,"y":-0.648}]
    var npts = [{"x":1.8,"y":0.8},{"x":2.1,"y":0.8},{"x":2.674,"y":-0.152},{"x":2.677,"y":0.799},{"x":2.95,"y":0.796},{"x":2.951,"y":-0.648},{"x":2.654,"y":-0.653},{"x":2.077,"y":0.275},{"x":2.077,"y":-0.64},{"x":1.804,"y":-0.646}]
    var gpts = [{"x":3.924,"y":0.124},{"x":4.547,"y":0.124},{"x":4.55,"y":-0.46},{"x":4.3,"y":-0.6},{"x":4.01,"y":-0.667},{"x":3.77,"y":-0.66},{"x":3.515,"y":-0.567},{"x":3.338,"y":-0.405},{"x":3.245,"y":-0.205},{"x":3.2,"y":0},{"x":3.217,"y":0.197},{"x":3.26,"y":0.4},{"x":3.35,"y":0.568},{"x":3.5,"y":0.7},{"x":3.7,"y":0.8},{"x":3.9,"y":0.823},{"x":4.1,"y":0.8},{"x":4.31,"y":0.72},{"x":4.45,"y":0.593},{"x":4.537,"y":0.396},{"x":4.253,"y":0.335},{"x":4.157,"y":0.468},{"x":4,"y":0.55},{"x":3.8,"y":0.55},{"x":3.635,"y":0.466},{"x":3.554,"y":0.34},{"x":3.5,"y":0.2},{"x":3.5,"y":0},{"x":3.555,"y":-0.206},{"x":3.7,"y":-0.357},{"x":3.85,"y":-0.418},{"x":3.998,"y":-0.42},{"x":4.143,"y":-0.362},{"x":4.25,"y":-0.3},{"x":4.247,"y":-0.123},{"x":3.92,"y":-0.12}]
    var allpts = [lpts,opts,apts,dpts,ipts,npts,gpts]

    const arrdepth = 10
    var range2 = Array.from(Array(2*arrdepth*7).keys()).map(x => x + 1)

    svg.selectAll("polygon").remove()
    svg.selectAll("path").remove()
    svg.selectAll("circle").remove()

    // So we can get one layer of text- can we do multiple players? 
    // Might be a clever way to do this in the append function, or do some annoying mapping stuff idk

    svg.selectAll("polygon")
    .data(range2)
    .enter().append("polygon")
    .attr("points",function(r) { 
        return allpts[r % 7].map(function(point){
            return project(100*point.x+40*Math.cos((2*((r%7)%2)-1)*tau*2*timer+0.2*Math.floor(r/7)),
            100*point.y+40*Math.sin((2*((r%7)%2)-1)*tau*2*timer+0.2*Math.floor(r/7)),
            10*(Math.floor(r/7)-arrdepth),controlpt).join(",");
        }).join(" ");
    })
    .attr("stroke","black")
    .attr("stroke-width",2)
    .attr("fill",function(d){
      return "hsl(" + (360*((d/(7*arrdepth)+timer)%1)).toString() + ", 100%, 70.5%)" 
    })
}
  
const LoadingAll: React.FunctionComponent = () => {
    const svg = React.useRef<SVGSVGElement>(null);
    const [Timer, setTimer] = useState<number>(0)
    const [
        mousePosition,
        setMousePosition
      ] = React.useState({ x: 0, y: 0 });

      const updateMousePosition = (ev: { clientX: any; clientY: any; }) => {
        setMousePosition({ x: ev.clientX, y: ev.clientY });
      };

    React.useEffect(() => {
        window.addEventListener('mousemove', updateMousePosition);
        const interval = setInterval(() => {
            setTimer((Timer + 0.00025) % 1)
            //So here is where we will choose which one to render. We ahve four different ones
            if(Timer < 0.25){
                draw3D(svg,mousePosition.x,mousePosition.y, 4*Timer);
            }
            else if(Timer < 0.5){
                drawClock(svg, 4*Timer);
            }
            else if(Timer < 0.75){
                drawDistort(svg,mousePosition.x,mousePosition.y);
            }
            else{
                drawLight(svg,mousePosition.x,mousePosition.y, 4*Timer);
            }
        }
        , 10);
        return () =>{window.removeEventListener('mousemove', updateMousePosition);
        clearInterval(interval)}
    }, [svg, Timer]);
  
    return (
      <div id="chart" className="flex bg-yellow-100 items-center justify-center w-full flex-col min-h-screen gap-0">
        <svg ref={svg}/>
      </div>
    );
  };
  
  
  export default LoadingAll;